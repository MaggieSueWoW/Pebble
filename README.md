# Pebble

This is a small bot to help our team with tracking bench time.

95%+ of the code was generated by ChatGPT via Codex.

There is still more to do to finish it up, test it, and cleanup the code a bit more. But it works well enough right now to share and explore its usefulness.

There is a spec in [raid_time_fairness.md](raid_time_fairness.md) which covers most of what this does and why.

## Continuous processing loop

Use the `loop` command to continuously ingest new data and recompute exports. Each iteration runs the full ingest, compute, and week phases and reloads configuration so changes are picked up without restarting the process.

```bash
pebble loop --config config.yaml --trigger-timeout 180
```

The loop continues until interrupted. Use `--max-errors 0` to keep it running regardless of transient failures.

## Docker

A Docker image is provided for running the loop in a container. Build and run it with:

```bash
docker build -t pebble-loop .
docker run --rm \
  -v "$PWD/config.yaml:/app/config.yaml:ro" \
  -v "$PWD/service-account.json:/app/service-account.json:ro" \
  pebble-loop loop --config /app/config.yaml --interval 300
```

Mount any required credentials (e.g., Google service account JSON) and override the command arguments as needed.
